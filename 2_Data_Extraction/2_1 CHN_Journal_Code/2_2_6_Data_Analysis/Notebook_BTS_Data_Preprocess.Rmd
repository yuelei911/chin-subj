---
title: "Notebook_BTS_Data_Preprocess"
author: "Lei Yue"
date: "2025-02-06"
output: html_document
---

**Special Note:**BTS\_, This indicates data sourced from large-scale international collaborations.

# install and library packages
```{r}
rm(list = ls())

if (!require("pacman")) install.packages("pacman")

# use package "pacman" as loading R packages tools

pacman::p_load("tidyverse","here","rio")
```


# Load the data of BTS
```{r}
load("D://chin-subj//2_Data_Extraction//2_2_BTS//BTS_data1.Rdata")

load("D://chin-subj//2_Data_Extraction//2_2_BTS//BTS_data2.Rdata")
```


Next, I loaded all BTS data and processed BTS data.
```{r message=FALSE, warning=FALSE, include=FALSE}

BTS_Lucca_et_al_2024 <- BTS_Kelsey_et_al_2024
rm(BTS_Kelsey_et_al_2024,raw_Elbæk_et_al_2023)
BTS_Bertolo_et_al_2023 <- BTS_Bertolo_et_al_2023 %>% 
  dplyr::mutate(Article_Id = "Bertolo_et_al_2023")


## trans data.frame to list
current_data_frame <- ls()[sapply(ls(), function(x) is.data.frame(get(x)))]
BTS0 <-  mget(current_data_frame)
BTS <- BTS0

rm(current_data_frame)
```


# Process BTS data
Uniform country codes facilitate subsequent data processing and analysis, especially for batch processing and analysis of data. Thus, I created a unified table of country codes.
```{r}
if(!require("countrycode")) install.packages("countrycode")

Countrycodelist <- codelist

Countrycodelist_iso2_iso3 <- Countrycodelist %>% 
  dplyr::select(country.name.en,iso2c,iso3c) %>% 
  dplyr::rename(Countryfullname = 1,ISO2 = 2, ISO3 = 3)

Countrycodelist_iso2_iso3$ISO2[Countrycodelist_iso2_iso3$Countryfullname == "Kosovo"] <- "XK"
Countrycodelist_iso2_iso3$ISO3[Countrycodelist_iso2_iso3$Countryfullname == "Kosovo"] <- "XKX"

## Here, I remove some data sets to reduce data set clutter.
rm(Countrycodelist)
```


The third hypothesis requires countries to be divided into WEIRD and non-WEIRD, so I created a data.frame of WEIRD countries to facilitate subsequent analysis and visualization.
```{r}
WEIRD <- codelist %>% 
  dplyr::select(3,6,iso2c,iso3c,region,region23) %>% 
  dplyr::mutate(WEIRD = ifelse(continent == "Europe" | region == "North America","WEIRD",NA),
                WEIRD = ifelse(continent %in% c("Africa","Asia") | region == "Latin America & Caribbean" | region == "East Asia & Pacific", "Non_WEIRD",WEIRD)) %>% 
  dplyr::mutate(WEIRD = ifelse(country.name.en %in% c("Israel","Australia","New Zealand"), "WEIRD",WEIRD),
                WEIRD = ifelse(is.na(WEIRD),"Non_WEIRD",WEIRD))
```


As the data for the large-scale international collaboration project is constantly updated, recording the names and order of data frames in the list here will facilitate the subsequent improvement of the code.
```{r}
names(BTS)

# [1] "BTS_Anllo_et_al_2023"                                                              
#  [2] "BTS_Arechar_et_al_2023"                                                            
#  [3] "BTS_Atari_et_al_2020"                                                              
#  [4] "BTS_Awad_et_al_2018"                                                               
#  [5] "BTS_Azevedo_et_al_2022"                                                            
#  [6] "BTS_Bago_et_al_2022"                                                               
#  [7] "BTS_Bosson_et_al_2021"                                                             
#  [8] "BTS_Buchanan_et_al_2023"                                                           
#  [9] "BTS_Dorison_et_al_2020"                                                            
# [10] "BTS_Elbæk_et_al_2023"                                                              
# [11] "BTS_Eriksson_et_al_2021"                                                           
# [12] "BTS_Everett_et_al_2021"                                                            
# [13] "BTS_Fernandez_Velasco_et_al_2023"                                                  
# [14] "BTS_Greenberg_et_al_2022"                                                          
# [15] "BTS_Hall_et_al_2018"                                                               
# [16] "BTS_Hoogeveen_et_al_2022"                                                          
# [17] "BTS_Hu_et_al_2019"                                                                 
# [18] "BTS_Jones_et_al_2021"                                                              
# [19] "BTS_Kirkland_et_al_2022"                                                           
# [20] "BTS_Klein_et_al_2018_1"                                                            
# [21] "BTS_Klein_et_al_2018_2"                                                            
# [22] "BTS_Kowal_et_al_2022"                                                              
# [23] "BTS_Lucca_et_al_2024"                                                              
# [24] "BTS_Manokara_et_al_2022"                                                           
# [25] "BTS_Pizzol_et_al_2023"                                                             
# [26] "BTS_Psychological_Science_Accelerator_Self_Determination_Theory_Collaboration_2022"
# [27] "BTS_Ruggeri_et_al_2020"                                                            
# [28] "BTS_Ruggeri_et_al_2022"                                                            
# [29] "BTS_Sorokowski_et_al_2023"                                                         
# [30] "BTS_Tybur_et_al_2016"                                                              
# [31] "BTS_Van_Bavel_et_al_2022"                                                          
# [32] "BTS_Vlasceanu_et_al_2023"                                                          
# [33] "BTS_Wang_et_al_2021"  


## save each data.frame colnames
colname_list <- list()


# Loop through each dataframe in the list
for (name in names(BTS)) {
  
  df <- BTS[[name]]
  col_names <- colnames(df)
  
  temp_df <- data.frame(
    data_source = name,
    column_name = col_names
  )
  colname_list[[name]] <- temp_df
}


# Combine the result list into a single data.frame
BTS_colnames <- do.call(rbind, colname_list)
rm(colname_list,temp_df,col_names,name,df)
```



In this part, I tried to batch country code.

```{r}
# str(BTS)
## Handle some more specific encodings
names(BTS[[21]])[names(BTS[[21]]) == "Country_now"] <- "Country"  ## BTS_Klein 2018 Slate1

names(BTS[[22]])[names(BTS[[22]]) == "Country_now"] <- "Country"  ## BTS_Klein 2018 Slate2

names(BTS[[23]])[names(BTS[[23]]) == "Country_now"] <- "Country"  ## BTS_Kowal 2018

names(BTS[[34]])[names(BTS[[34]]) == "Country_now"] <- "Country"  ## BTS_Wang 2021

names(BTS[[31]])[names(BTS[[31]]) == "Country_ID"]  <-  "Country" ## BTS_Tybur 2016

BTS[[9]]$Country <- trimws(sub(".*-(\\s*)", "", BTS[[9]]$Country))    ## BTS_Buchanan 2023
BTS[[34]]$Country <- trimws(sub(".*-(\\s*)", "", BTS[[34]]$Country))  ## BTS_Wang 2021



## process abnormal Countrycode
## BTS_Anllo_et_al_2023
BTS[[1]] <- BTS[[1]] %>% 
  dplyr::mutate(Country = ifelse(Country == "USA", "United States",Country))



## BTS_Arechar_et_al_2023
BTS[[2]] <- BTS[[2]] %>% 
  dplyr::mutate(Country = ifelse(Country == "uk", "gb",Country))



## BST_Atari_et_al_2020
BTS[[3]] <- BTS[[3]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "US", "United States",Country))



## BTS_Awad_et_al_2018
# BTS[[4]] <- BTS[[4]] %>% 
#   dplyr::mutate(Country = case_when(Country %in% c("TWN","HKG","MAC") ~ "CHN",
#                                     TRUE ~ Country))



## BTS_Azevedo_et_al_2022
BTS[[5]] <- BTS[[5]] %>% 
  dplyr::mutate(Country = case_when(Country %in% c("BR1","BR2","BR3") ~ "BR",
                                    Country %in% c("CAe","CAf") ~ "CA",
                                    Country %in% "CO2" ~ "CO",
                                    Country %in% "IN2" ~ "IN",
                                    Country %in% c("IT1","IT2") ~ "IT",
                                    Country %in% "MX2" ~ "MX",
                                    Country %in% "RO2" ~ "RO",
                                    Country %in% "CHN" ~ "CN",
                                    TRUE ~ Country))



## BTS_Bago_et_al_2022 
## its country code data from https://lab2.labinthewild.org/multitasking/
BTS_Bago_et_al_2022_Countrycode <- readxl::read_xlsx("D://chin-subj//2_Data_Extraction//2_2_BTS//BTS_Bago_et_al_2022_Countrycode.xlsx") %>% 
  dplyr::mutate(Country = as.character(Country))

BTS[[6]] <- BTS[[6]] %>% 
  dplyr::left_join(BTS_Bago_et_al_2022_Countrycode,
                   by = "Country") %>% 
  dplyr::rename(Country_IDs = Country)


BTS[[6]] <- BTS[[6]] %>% 
  dplyr::mutate(Country = case_when(Country_region_name %in% c("Faroe Islands","Greenland") ~ "Denmark",
                                    Country_region_name %in% c("French Guiana","French Polynesia",
                                                 "French Southern Territories",
                                                 "Guadeloupe","Martinique","Reunion") ~ "France",
                                    Country_region_name == "Aruba" ~ "Netherlands",
                                    Country_region_name == "Cook Islands" ~ "New Zealand",
                                    Country_region_name %in% c("Bermuda","British Indian Ocean Territory",
                                                 "Cayman Islands","Falkland Islands (Malvinas)",
                                                 "Gibraltar","Guernsey","Jersey",
                                                 "Montserrat","Pitcairn","Turks And Caicos Islands") ~ "United Kingdom",
                                    Country_region_name %in% c("Northern Mariana Islands","Puerto Rico","U.S. Virgin Islands") ~ "United States",
                                    TRUE ~ Country_region_name))


BTS[[6]] <- BTS[[6]] %>% 
  dplyr::mutate(Country == case_when(Country == "Aland Islands" ~  "Åland Islands",
                                     Country == "Antigua And Barbuda" ~ "Antigua & Barbuda",
                                     Country == "Bosnia And Herzegovina" ~ "Bosnia & Herzegovina",
                                     Country == "Brunei Darussalam" ~ "Brunei",
                                     Country == "Cote Divoire" ~ "Côte d’Ivoire",
                                     Country == "Czechia" ~ "Czech Republic",
                                     Country == "North Korea" ~ "Democratic Peoples Republic of Korea",
                                     Country == "Guinea-bissau" ~ "Guinea-Bissau",
                                     Country == "Heard Island And Mcdonald Islands" ~ "Heard & McDonald Islands",
                                     Country == "Holy See (Vatican City State)" ~ "Vatican City",
                                     Country == "Isle Of Man" ~ "Isle of Man",
                                     Country == "Lao Peoples Democratic Republic" ~ "Laos",
                                     Country == ""))


df <- BTS[[6]]
Tab <- data.frame(table(df$Country))

df <- df %>% 
  dplyr::anti_join(Countrycodelist_iso2_iso3,by = c("Country" = "Countryfullname"))
Tab2 <- data.frame(table(df$Country))

# write.csv(Tab,"Tab.csv")
# ## BTS_Bertolo_et_al_2023
BTS[[7]] <- BTS[[7]] %>%
  dplyr::mutate(Country = case_when(Country == "Antigua And Barbuda" ~  "Antigua & Barbuda",
                                    Country == "Artsakh"  ~  "Azerbaijan", #*
                                    Country %in% c("Côte D'ivoire","Ivory Coast") ~  "Côte d’Ivoire",
                                    Country == "Democratic People's Republic Of Korea" ~ "North Korea",
                                    Country == "Democratic Republic Of The Congo" ~ "Congo - Kinshasa",
                                    Country == "East Timor" ~  "Timor-Leste",
                                    Country == "Kingdom Of The Netherlands"  ~  "Netherlands",
                                    Country == "Micronesia"  ~ "Micronesia (Federated States of)",
                                    Country == "Myanmar"  ~  "Myanmar (Burma)",
                                    # Country == "Northern Cyprus" #*
                                    Country == "Palestine"  ~ "Palestinian Territories",
                                    Country == "Sahrawi Arab Democratic Republic" ~ "Western Sahara", #*
                                    Country == "Saint Kitts And Nevis" ~ "St. Kitts & Nevis",
                                    Country == "Saint Lucia" ~ "St. Lucia",
                                    Country == "Saint Vincent And The Grenadines" ~  "St. Vincent & Grenadines",
                                    # Country == "Somaliland" ~ "", #*
                                    # Country == "South Ossetia" ~ "", #*
                                    Country == "Swaziland" ~ "Eswatini",
                                    Country == "São Tomé And Príncipe" ~ "São Tomé & Príncipe",
                                    Country == "The Bahamas" ~ "Bahamas",
                                    Country == "The Gambia" ~ "Gambia",
                                    # Country == "Transnistria" ~ "", #*
                                    Country == "Trinidad And Tobago" ~ "Trinidad & Tobago",
                                    TRUE ~ Country))




## BTS_Bosson_et_al_2021
BTS[[8]] <- BTS[[8]] %>% 
  dplyr::mutate(Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "CHN", "China",Country),
                Country = ifelse(Country == "UEA", "United Arab Emirates",Country),
                Country = ifelse(Country == "Bosnia and. Herz.","Bosnia & Herzegovina",Country))



## BTS_Buchanan_et_al_2023
BTS[[9]] <- BTS[[9]] %>% 
  dplyr::mutate(Country = case_when(Country %in% c("TWN","HKG","MAC") ~ "CHN",
                                    TRUE ~ Country),
                Country = ifelse(Country == "NA",NA,Country),
                Country = ifelse(Country == "KEN, NA", "KEN",Country))



## BTS_Dorison_et_al_2020
BTS[[10]] <- BTS[[10]] %>% 
  dplyr::mutate(Country = trimws(Country)) %>% 
  dplyr::mutate(Country = ifelse(Country == "TWN" | Country == "HKG"| Country == "MAC","CHN",Country),
                Country = ifelse(Country == "many", NA, Country))



## BTS_Elbæk_et_al_2023



## BTS_Eriksson_et_al_2021
BTS[[12]] <- BTS[[12]] %>% 
  dplyr::mutate(Country = trimws(Country)) %>% 
  dplyr::mutate(Country = case_when(Country == "Ivory Coast" ~  "Côte d’Ivoire",
                                    Country == "Trinidad And Tobago" ~ "Trinidad & Tobago",
                                    Country == "UAE" ~ "United Arab Emirates",
                                    Country == "Czech Republic" ~ "Czechia",
                                    Country == "Bosnia and Herzegovina" ~ "Bosnia & Herzegovina",
                                    
                                    TRUE ~ Country))



## Everett_et_al_2021
BTS[[13]] <- BTS[[13]] %>% 
  dplyr::mutate(Country = ifelse(Country == "Kingdom of Saudi Arabia","Saudi Arabia",Country),
                Country = ifelse(Country == "The Netherlands", "Netherlands",Country))



## BTS_Fernandez_Velasco_et_al_2023
BTS[[14]] <- BTS[[14]] %>%
  dplyr::mutate(Country = case_when(Country %in% c("TW","HK","MO") ~ "CN",
                                    TRUE ~ Country))



## BTS_Greenberg_et_al_2022
## its country code data from https://socialintelligence.labinthewild.org/mite/?
BTS_Greenberg_et_al_2022_Countrycode <- readxl::read_xlsx("D://chin-subj//2_Data_Extraction//2_2_BTS//BTS_Greenberg_et_al_2022_Countrycode.xlsx") 


BTS[[15]] <- BTS[[15]] %>% 
  dplyr::left_join(BTS_Greenberg_et_al_2022_Countrycode,
                   by = "Country") %>% 
  dplyr::rename(Country_IDs = Country,
                Country = Country_name)

df <- BTS[[11]]
## BTS_Hall_et_al_2018
BTS[[16]] <- BTS[[16]] %>%
  dplyr::mutate(Country = case_when(Country %in% c("TWN","HKG","MAC") ~ "CHN",
                                    TRUE ~ Country))



## BTS_Hoogeveen_et_al_2022
BTS[[17]] <- BTS[[17]] %>%
  dplyr::mutate(
    Country = ifelse(Country == "US", "United States", Country),
    Country = ifelse(Country == "CHN", "China", Country),
    Country = ifelse(Country == "UK", "United Kingdom", Country))
                
      
### BTS_Hu_et_al_2019
## I converted the country codes based on the information in the IJzerman et al (2018), https://doi.org/10.1525/collabra.165.

BTS[[18]] <- BTS[[18]] %>% 
  dplyr::mutate(Country = case_when(Country == "Bamberg" ~ "Germany",
                                    Country == "Kassel" ~ "Germany",
                                    Country == "METU" ~ "Turkey",
                                    Country == "Oslo" ~ "Norway",
                                    Country == "Oxford" ~ "United Kingdom",
                                    Country == "SMU" ~ "Singapore",
                                    Country == "Southampton" ~ "United Kingdom",
                                    Country == "Tsinghua" ~ "China",
                                    Country == "UCSB" ~ "United States",
                                    Country == "Zurich" ~ "Switzerland",
                                    Country == "VCU" ~ "United States",
                                    TRUE ~ Country))


## BTS_Jones_et_al_2021
BTS[[19]] <- BTS[[19]] %>%
  dplyr::mutate(Country = case_when(Country %in% c("TW","HK","MO") ~ "CN",
                                    TRUE ~ Country))



## BTS_Kirkland_et_al_2022
BTS[[20]] <- BTS[[20]] %>% 
   dplyr::mutate(Country = case_when(Country %in% c("Canada_EN","Canada_FR") ~ "Canada",
                                    Country %in% "CHN" ~ "China",
                                    Country %in% "Hong Kong" ~ "China",
                                    Country %in% c("Northern Ireland","Scotland","Wales","England") ~ "United Kingdom",
                                    Country %in% c("USA_North","USA_South") ~ "United States",
                                    TRUE ~ Country))



## BTS_Klein_et_al_2018 Slate1
BTS[[21]] <- BTS[[21]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "The Netherlands","Netherlands",Country),
                Country = ifelse(Country == "Czech Republic" ,"Czechia",Country))



## BTS_Klein_et_al_2018 Slate2
BTS[[22]] <- BTS[[22]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "The Netherlands","Netherlands",Country),
                Country = ifelse(Country == "Czech Republic" ,"Czechia",Country))



## BTS_Kowal_et_al_2022
BTS[[23]] <- BTS[[23]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "Bosnia and Herzegovina","Bosnia & Herzegovina",Country),
                Country = ifelse(Country == "Czech Republic","Czechia",Country),
                Country = ifelse(Country == "CHN","China",Country))



# BTS_Lucca_et_al_2024
BTS[[24]] <- BTS[[24]] %>% 
  dplyr::rename(Country = 2) %>% 
  dplyr::mutate(Country = case_when(Country == "babylabamsterdam" ~ "Netherlands",
                                    Country == "babylablmu" ~ "Germany",
                                    Country == "babylabmpib" ~ "Germany",
                                    Country == "babylabosaka" ~ "Japan",
                                    Country == "babylabtrento" ~ "Italy",
                                    Country == "babylabulb" ~ "Belgium",
                                    Country == "babylabuva" ~ "United States",
                                    Country == "babylabvuw" ~ "New Zealand",
                                    Country == "beinghumanwroclaw" ~ "Poland",
                                    Country == "biccbabylab" ~ "Italy",
                                    Country == "bllumanitoba" ~ "Canada",
                                    Country == "cbplabumn" ~ "United States",
                                    Country == "childstudiesucsb"~ "United States",
                                    Country == "cogcienmat_univalle" ~ "Colombia",
                                    Country == "cogdevlabhku"  ~ "China", ## this data is China Hongkong
                                    Country == "corbitlab" ~ "Canada",
                                    Country == "cutelabunak" ~ "Iceland",
                                    Country == "devlabmta" ~ "New Zealand",
                                    Country == "emlasu" ~ "United States",
                                    Country == "epsyrub" ~ "Germany",
                                    Country == "gaugGottingen" ~ "Germany",
                                    Country == "ikidstutsc" ~ "Canada",
                                    Country == "infantcog_ubc" ~ "Canada",
                                    Country == "irlconcordia" ~ "Canada",
                                    Country == "kidsdevuniofnewcastle" ~ "Australia",
                                    Country == "kikoceu" ~ "Hungary",
                                    Country == "langdevhaifa" ~ "Israel",
                                    Country == "lmumunich" ~ "Germany",
                                    Country == "mecdmpihcbs" ~ "Germany",
                                    Country == "pkusu" ~ "China",
                                    Country == "socallabucsd" ~ "United States",
                                    Country == "uiwcarl" ~ "United States",
                                    Country == "weltentdeckerzurich" ~ "Switzerland",
                                    Country == "wsumarcs" ~ "Australia",
                                    Country == "yonseichild" ~ "South Korea",
                                    TRUE ~ Country))




## BTS_Mankara_et_al_2022
BTS[[25]] <- BTS[[25]] %>% 
  dplyr::mutate(Country = ifelse(Country == "CHN","China",Country))



## BTS_Pizzol_et_al_2023
BTS[[26]] <- BTS[[26]] %>% 
  dplyr::mutate(Country = case_when(Country == "Korea, Rep." ~  "South Korea",
                                    Country == "Russian Federation" ~ "Russia",
                                    Country == "Slovak Republic" ~ "Slovakia",
                                    Country == "Taiwan, China" ~ "China",
                                    Country == "Venezuela, RB" ~ "Venezuela",
                                    TRUE ~ Country))



## BTS_Psychological_Science_Accelerator_Self_Determination_Theory_Collaboration_2022
BTS[[27]] <- BTS[[27]] %>% 
  dplyr::mutate(Country = ifelse(Country == "IRAN", "IRN", Country),
                Country = ifelse(Country == "SLO", NA, Country),
                Country = ifelse(Country == "TWN" | Country =="HKG" | Country == "MAC","CHN",Country))



## BTS_Ruggeri_et_al_2020
BTS[[28]] <- BTS[[28]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "Mainland China" | Country == "Hong Kong", "China",Country))



## BTS_Ruggeri_et_al_2022
BTS[[29]] <- BTS[[29]] %>% 
  dplyr::mutate(Country = ifelse(Country == "BRG", "BGR",Country),
                Country = ifelse(Country == "SRP", "SGP",Country))



## BTS_Sorokowski_et_al_2023
BTS[[30]] <- BTS[[30]] %>% 
  dplyr::mutate(Country = ifelse(Country == "The Netherlands", "Netherlands",Country),
                Country = ifelse(Country == "CHN","China",Country))



# BTS_Tybur_et_al_2016 
BTS[[31]] <- BTS[[31]] %>% 
  dplyr::mutate(Country = as.character(Country),
                Country = case_when(Country == "1" ~ "IL",
                                    Country == "2" ~ "SG",
                                    Country == "3" ~ "BE",
                                    Country == "4" ~ "RS",
                                    Country == "5" ~ "ES",
                                    Country == "6" ~ "AU",
                                    Country == "7" ~ "SK",
                                    Country == "8" ~ "FR",
                                    Country == "9" ~ "NZ",
                                    Country == "10" ~ "DK",
                                    Country == "11" ~ "IN",
                                    Country == "12" ~ "JP",
                                    Country == "13" ~ "DE",
                                    Country == "14" ~ "HR",
                                    Country == "15" ~ "PL",
                                    Country == "16" ~ "TR",
                                    Country == "17" ~ "US",
                                    Country == "18" ~ "CA",
                                    Country == "19" ~ "GR",
                                    Country == "20" ~ "IE",
                                    Country == "21" ~ "NL",
                                    Country == "22" ~ "BA",
                                    Country == "23" ~ "UK",
                                    Country == "24" ~ "CL",
                                    Country == "25" ~ "KR",
                                    Country == "26" ~ "SE",
                                    Country == "27" ~ "FI",
                                    Country == "28" ~ "BR",
                                    Country == "29" ~ "AR",
                                    Country == "30" ~ "CN",
                                    TRUE ~ Country))



## BTS_Van_Bavel_et_al_2022
BTS[[32]] <- BTS[[32]] %>% 
  dplyr::mutate(Country = as.character(unclass(Country)),
                Country = case_when(Country == "TW" ~ "CN",
                                    TRUE ~ Country))



## BTS_Vlasceanu_et_al_2023
BTS[[33]] <- BTS[[33]] %>% 
  dplyr::mutate(Country = ifelse(Country == "Uk", "United Kingdom",Country),
                Country = ifelse(Country == "Usa", "United States",Country),
                Country = case_when(Country == "Newzealand" ~ "New Zealand",
                                    Country == "Northmacedonia" ~ "North Macedonia",
                                    Country == "Saudiarabia" ~ "Saudi Arabia",
                                    Country == "Southafrica" ~ "South Africa",
                                    Country == "Southkorea" ~ "South Korea",
                                    Country == "Srilanka" ~ "Sri Lanka",
                                    Country == "Unitedarabemirates" ~ "United Arab Emirates",
                                    Country == "Taiwan" ~ "China",
                                    TRUE ~ Country))

                                    
                                    
## BTS_Wang_et_al_2021
BTS[[34]] <- BTS[[34]] %>% 
  dplyr::mutate(Country = ifelse(Country == "China", "CHN",Country))

  

BTS <- BTS[-c(6,14)] ## remove data.frame with the country code as num (Bago et al 2022, Greenberg et al 2022)



## Create CountryCode line
BTS <- lapply(BTS, function(df){
  
  df <- df %>% 
    dplyr::mutate(Country = toupper(Country),
                  Country = ifelse(nchar(Country) > 3, str_to_title(Country),Country),
                  Countrycode = ifelse(nchar(Country) > 3, "Countryfullname", 
                                ifelse(nchar(Country) == 3, "ISO3", "ISO2")))
  
  return(df)
  
})



## Combine the BTS_data and Countrycodelist_iso2_iso3
Countrycode_merge <- function(df, Countrycode) {  
  
  Countrycode_lengths <- nchar(as.character(df$Country))  
  Countrycode_lengths <- Countrycode_lengths[!is.na(Countrycode_lengths)]  
 
  if (all(Countrycode_lengths == 2)) {  
    
    merge_key <- "ISO2"  
  } else if (any(Countrycode_lengths > 3)) {  
   
    merge_key <- "Countryfullname"  
  } else {  
   
    merge_key <- "ISO3"  
  }  
    
  merged_df <- merge(df, Countrycode, by.x = "Country", by.y = merge_key, all.x = TRUE)  
    
  return(merged_df)  
}  
  
BTS <- lapply(BTS, Countrycode_merge, Countrycode = Countrycodelist_iso2_iso3)  


## Check the countrycode of the BTS data
BTS_countrycode_check <- lapply(BTS, function(df){
  
  df <- df %>% 
    dplyr::group_by(Countrycode) %>% 
    dplyr::summarise(n=n()) %>% 
    dplyr::ungroup()
  
  return(df)
})

BTS_countrycode_check <- do.call(rbind, BTS_countrycode_check)



## Change the column name so that each BTS data has "ISO3"
BTS <- lapply(BTS,function(df){
  
  if(!"ISO3" %in% names(df)){
    
    df <- df %>% 
      dplyr::mutate(ISO3 = Country)
  }
  
  return(df)
  
})


## Change the column name so that each BTS data has "ISO2"
BTS <- lapply(BTS,function(df){
  
  if(!"ISO2" %in% names(df)){
    
    df <- df %>% 
      dplyr::mutate(ISO2 = Country)
  }
  
  return(df)
  
})


## Change the column name so that each BTS data has "countryfullname"
BTS <- lapply(BTS,function(df){
  
  if(!"Countryfullname" %in% names(df)){
    
    df <- df %>% 
      dplyr::mutate(Countryfullname = Country)
  }
  
  return(df)
  
})
```


process gender data of BTS
```{r}
## BTS_Bago_et_al_2022
BTS[[6]] <- BTS[[6]] %>% 
  dplyr::mutate(Gender = case_when(Gender == 1 ~ "Male",
                                   Gender == 2 ~ "Female"))
                

## Batch processing of gender for different data sources
BTS <- lapply(BTS,function(df){
  
  df <- df %>% 
    dplyr::mutate(Gender = case_when(Gender %in% c("f","F") ~ "Female",
                              Gender %in% c("m","M") ~ "Male",
                              TRUE ~ Gender),
           Gender = str_to_title(Gender))
  
  return(df)
  
})


## Check the gender of the BTS data
BTS_gender_check <- lapply(BTS, function(df){
  
  df <- df %>% 
    dplyr::group_by(Gender) %>% 
    dplyr::summarise(n=n()) %>% 
    dplyr::ungroup()
  
  return(df)
})

BTS_gender_check <- do.call(rbind, BTS_gender_check)



## process gender of BTS 
## BTS_Buchanan_et_al_2023
BTS[[9]] <- BTS[[9]] %>% 
  dplyr::mutate(Gender = ifelse(Gender == "Female, Female","Female",Gender))


## BTS_Hoogeveen_et_al_2022
BTS[[17]] <- BTS[[17]] %>% 
  dplyr::mutate(Gender = ifelse(Gender == "Man", "Male",Gender),
                Gender = ifelse(Gender == "Woman","Female",Gender))
```


process age data of BTS
```{r}
## BTS_Awad_et_al_2018
## According to the document "MMdata_Readme.txt" by Awad et al (2018), the section "- Review_age: answer to the question 'How old are you?' Age is collected via an empty box (users can input numbers). Only data corresponding to age between 18 and 75 is included." indicates that we have decided to set the age range for this project as 18 to 75.
BTS[[4]] <- BTS[[4]] %>% 
  dplyr::mutate(Age = ifelse(Age < 18 | Age >75,NA,Age))


## BTS_Hu_et_al_2019
## Hu et al' data collect in 2016, see https://doi.org/10.1525/collabra.165
BTS[[18]] <- BTS[[18]] %>% 
  dplyr::mutate(Age = 2016 - Age)


## BTSK_lein_et_al_2018_Slate2
BTS[[21]] <- BTS[[21]] %>% 
  dplyr::mutate(Age = ifelse(Age > 200, 2014-Age,Age))


## Lucca et al. 2024'Age use age days record subjects' age, therefore I will transform
## Lucca et al. 2024
BTS[[24]] <- BTS[[24]] %>% 
  dplyr::mutate(Age = round((Age_days/365),2))


## BTS_Vlasceanu_et_al_2023
BTS[[33]] <- BTS[[33]] %>% 
  dplyr::mutate(Age = ifelse(Age == "NA",NA,Age))
```


process attainment education of BTS
```{r}
## BTS_Arechar_et_al_2023
BTS[[2]] <- BTS[[2]] %>% 
  dplyr::mutate(Education = case_when(Education == 1 ~ "None",
                                      Education == 2 ~ "Less than secondary school degree",
                                      Education == 3 ~ "Less than high school degree",
                                      Education == 4 ~ "High school diploma",
                                      Education == 5~ "Attended College",
                                      Education == 6 ~ "Bachelor's degree",
                                      Education == 7 ~ "Graduate degree",
                                      TRUE ~ Education))



## BTS_Bago_et_al_2022
BTS[[6]] <- BTS[[6]] %>%
  dplyr::mutate(Education = case_when(Education == 1 ~ "Below high school",
                                      Education == 2 ~ "Highschool",
                                      Education == 3 ~ "Bachelor’s degree",
                                      Education == 4 ~ "Master’s degree",
                                      Education == 5 ~ "Doctoral degree",
                                      TRUE ~ Education))


## BTS_Bertolo_et_al_2023
BTS[[7]] <- BTS[[7]] %>% 
  dplyr::mutate(education = case_when(Education == 1 ~ "Some elementary/middle school (primary school)",
                                      Education == 2 ~ "Completed elementary/middle school (primary school)",
                                      Education == 3 ~ "Some high school",
                                      Education == 4 ~ "Completed high school (secondary school)",
                                      Education == 5 ~  "Some undergrad (higher education)",
                                      Education == 6 ~  "Completed undergrad degree (~3-5 years higher education)",
                                      Education == 7 ~ "Some graduate school",
                                      Education == 8 ~ "Completed graduate school"))


## BTS_Eriksson_et_al_2021
BTS[[12]] <- BTS[[12]] %>% 
  dplyr::mutate(Education = as.character(Education),
                Education = case_when(Education == "1" ~ "Less than high school degree",
                                      Education == "2" ~ "High school graduate",
                                      Education == "3" ~ "Some college but no degree",
                                      Education == "4" ~ "Bachelor's/Associate degree",
                                      Education == "5" ~ "Master's degree",
                                      Education == "6" ~ "Doctoral degree",
                                      TRUE ~ Education))


## BTS_Everett_et_al_2021
BTS[[13]] <- BTS[[13]] %>% 
  dplyr::mutate(Education = as.character(Education),
                Education = case_when(Education == "1" ~ "Some elementary school",
                                      Education == "2" ~ "Completed elementary school",
                                      Education == "3" ~ "Some high school",
                                      Education == "4" ~ "Completed high school",
                                      Education == "5" ~ "Some college",
                                      Education == "6" ~ "Completed college",
                                      Education == "7" ~ "Completed some postgraduate study",
                                      Education == "8" ~ "Completed advanced postgraduate degree",
                                      TRUE ~ Education))



## BTS_Greenberg_et_al_2022
BTS[[15]] <- BTS[[15]] %>%
  dplyr::mutate(Education = case_when(Education == 1 ~ "pre-high school",
                                      Education == 2 ~ "high school",
                                      Education == 3 ~ "college",
                                      Education == 4 ~ "Master or a professional degree",
                                      Education == 5 ~ "PhD(Doctorate)"))


## BTS_Hoogeveen_et_al_2022
BTS[[17]] <- BTS[[17]] %>% 
  dplyr::mutate(Education = as.character(Education),
                Education = case_when(Education == "1" ~ "primary school",
                                      Education == "2" ~ "some high school",
                                      Education == "3" ~ "completed high school or equivalent",
                                      Education == "4" ~ "some university/college",
                                      Education == "5" ~ "completed university/college",
                                      Education == "6" ~ "some postgraduate work",
                                      Education == "7" ~ "completed a postgraduate degree",
                                      TRUE ~  Education))


## BTS_Klein_et_al_2018_Slate2 



## BTS_Psychological_Science_Accelerator_Self_Determination_Theory_Collaboration_2022
df <- BTS[[27]]

## BTS_Sorowski_et_al_2023
BTS[[30]] <- BTS[[30]] %>% 
  dplyr::mutate(Education = as.character(Education),
                Education = case_when(Education == "1" ~ "no formal",
                                      Education == "2" ~ "primary",
                                      Education == "3" ~ "secondary",
                                      Education == "4" ~ "high school",
                                      Education == "5" ~ "degree",
                                      TRUE ~ Education))
  
## BTS_Vlasceanu_et_al_2023
BTS[[33]] <- BTS[[33]] %>% 
  dplyr::mutate(Education = case_when(Education == 1 ~ "up to grade school/elementary school",
                                      Education == 2 ~ "up to high school",
                                      Education == 3 ~ "college/undergraduate university/certificate training",
                                      Education == 4 ~ "doctorate degree, medical degree,etc.",
                                      Education == "NA" ~ "Prefer not to answer",
                                      TRUE ~ Education))
```


Process edu of BTS data to the formal analysis
```{r}

BTS_edu_list <- list()

for (i in seq_along(BTS)) {
  
  BTS_name <- names(BTS)[[i]]

  if("Education" %in% names(BTS[[i]])){
   
    BTS_edu <- BTS[[i]] %>% 
      dplyr::select(Article_Id,Country,Education)
    
    BTS_edu_list[[BTS_name]] <- BTS_edu
    
  }else{
    
cat(sprintf("Skipping '%s' because it does not contain a 'Education' column.\n", BTS_name))  
    
  }
  
}




## BTS_Arechar_et_al_2023
BTS_edu_list[[1]] <- BTS_edu_list[[1]] %>% 
  dplyr::mutate(Highschool = case_when(Education == "None" ~ "Below_high_school",
                                       Education == "Less than secondary school degree" ~ "Below_high_school",
                                       Education == "Less than high school degree" ~ "Below_high_school",
                                       Education %in% c("High school diploma",
                                                        "Attended College",
                                                        "Bachelor's degree",
                                                        "Graduate degree") ~ "High_school_and_above"),
                College = case_when(Education %in% c("None","Less than secondary school degree","Less than high school degree","High school diploma") ~ "Below_college",
                                    Education %in% c("Attended College","Bachelor's degree","Graduate degree") ~ "College_and_above"))




## BTS_Awad_et_al_2018
BTS_edu_list[[2]] <- BTS_edu_list[[2]] %>% 
  dplyr::mutate(Highschool = case_when(Education == "underHigh" ~ "Below_high_school",
                                       Education %in% c("high","vocational","college","bachelor","graduate") ~ "High_school_and_above"),
                College = case_when(Education %in% c("underHigh","high","vocational") ~ "Below_college",
                                    Education %in% c("college","bachelor","graduate") ~ "College_and_above"))



## BTS_Bosson_et_al_2021
BTS_edu_list[[3]] <- BTS_edu_list[[3]] %>% 
  dplyr::mutate(Highschool = case_when(Education %in% c("Elementary school","I don't have any") ~ "Below_high_school",
                                       Education %in% c("Bachelor","Masters","Doctoral","Secondary school") ~ "High_school_and_above"),
                College = case_when(Education %in% c("Elementary school","I don't have any","Secondary school") ~ "Below_college",
                                    Education %in% c("Bachelor","Masters","Doctoral") ~ "College_and_above"))



## BTS_Dorison_et_al_2020
BTS_edu_list[[4]] <- BTS_edu_list[[4]] %>% 
  dplyr::mutate(Highschool = case_when(Education == "Less than high school" ~ "Below_high_school",
                                       Education %in% c("Doctorate","Four year degree","High school","Professional degree","Some college","Two year degree") ~ "High_school_and_above"),
                College = case_when(Education %in% c("Less than high school","High school") ~ "Below_college",
                                    Education %in% c("Doctorate","Four year degree","Professional degree","Some college","Two year degree") ~ "College_and_above"))



## BTS_Eriksson_et_al_2021
BTS_edu_list[[5]] <- BTS_edu_list[[5]] %>% 
  dplyr::mutate(Highschool = case_when(Education == "Less than high school degree" ~ "Below_high_school",
                                       Education %in% c("Bachelor's/Associate degree","Doctoral degree","High school graduate","Master's degree","Some college but no degree") ~ "High_school_and_above"),
                College = case_when(Education %in% c("Less than high school","High school graduate") ~ "Below_college",
                                    Education %in% c("Bachelor's/Associate degree","Doctoral degree","Master's degree","Some college but no degree") ~ "College_and_above"))



## BTS_Everett_et_al_2021
BTS_edu_list[[6]] <- BTS_edu_list[[6]] %>% 
  dplyr::mutate(Highschool = case_when(Education %in% c("Completed elementary school","Some elementary school") ~ "Below_high_school",
                                       Education %in% c("Completed advanced postgraduate degree","Completed college","Completed high school","Completed some postgraduate study","Some college","Some high school") ~ "High_school_and_above"),
                College = case_when(Education %in% c("Completed elementary school","Some elementary school","Completed high school","Some high school") ~ "Below_college",
                                    Education %in% c("Completed advanced postgraduate degree","Completed college","Completed some postgraduate study","Some college") ~ "College_and_above"))



## BTS_Fernandez_Velasco_et_al_2023
BTS_edu_list[[7]] <- BTS_edu_list[[7]] %>% 
  dplyr::mutate(Highschool = ifelse(Education == "tertiary","High_school_and_above",NA),
                College = ifelse(Education == "tertiary","College_and_above","Below_college"))



## BTS_Hall_et_al_2018


## BTS_Hoogeveen_et_al_2022
BTS_edu_list[[9]] <- BTS_edu_list[[9]] %>% 
  dplyr::mutate(Highschool = case_when(Education %in% c("primary school") ~ 
                                         "Below_high_school",
                                       Education %in% c("completed a postgraduate degree",
                                                        "completed high school or equivalent",
                                                        "completed university/college",
                                                        "some high school",
                                                        "some postgraduate work", 
                                                        "some university/college") ~ "High_school_and_above"),
                College = case_when(Education %in% c("primary school", 
                                              "completed high school or equivalent", 
                                              "some high school") ~ "Below_college",
                             Education %in% c("completed a postgraduate degree", 
                                              "completed university/college", 
                                              "some postgraduate work", 
                                              "some university/college") ~ "College_and_above"))



## BTS_Klein_et_al_2018_Slate1
BTS_edu_list[[10]] <- BTS_edu_list[[10]] %>% 
  mutate(Highschool = case_when(Education %in% c("Completed primary/elementary school", "No formal education") ~ "Below_high_school",
                                Education %in% c("Completed secondary school/high school", "Completed university/college degree", "Completed advanced degree", "Some university/college") ~ "High_school_and_above"),
         College = case_when(Education %in% c("Completed primary/elementary school", "Completed secondary school/high school", "No formal education") ~ "Below_college",
                             Education %in% c("Completed university/college degree", "Completed advanced degree", "Some university/college") ~ "College_and_above"))



## BTS_Klein_et_al_2018_Slate2
BTS_edu_list[[11]] <- BTS_edu_list[[11]] %>% 
  mutate(Highschool = case_when(Education %in% c("No formal education",
                                                 "Completed primary/elementary school") ~
                                  "Below_high_school",
                                Education %in% c("Completed secondary school/high school",
                                                 "Some university/college", 
                                                 "Completed university/college degree",
                                                 "Completed advanced degree") ~
                                  "High_school_and_above"),
         College = case_when(Education %in% c("No formal education",
                                              "Completed primary/elementary school",
                                              "Completed secondary school/high school") ~
                               "Below_college",
                             Education %in% c("Some university/college",
                                              "Completed university/college degree",
                                              "Completed advanced degree") ~
                               "College_and_above"))



## BTS_Psychological_Science_Accelerator_Self_Determination_Theory_Collaboration_2022



## BTS_Ruggeri_et_al_2020
BTS_edu_list[[13]] <- BTS_edu_list[[13]] %>% 
  mutate(Highschool = case_when(Education %in% c("Primary school") ~ "Below_high_school",
                                Education %in% c("Secondary school", "University Masters", "University MBA","University PhD", "University Undergraduate", "Vocational school") ~ "High_school_and_above"),
         College = case_when(Education %in% c("Primary school", "Secondary school", "Vocational school") ~ "Below_college",
                             Education %in% c("University Masters", "University MBA", "University PhD","University Undergraduate") ~ "College_and_above"))



## BTS_Ruggeri_et_al_2022
BTS_edu_list[[14]] <- BTS_edu_list[[14]] %>% 
  mutate(Highschool = case_when(Education %in% c("Primary ed.") ~ "Below_high_school",
                                Education %in% c("Bachelor", "Graduate", "Secondary ed.","Technical ed.") ~ "High_school_and_above"),
         College = case_when(Education %in% c("Primary ed.", "Secondary ed.", "Technical ed.") ~ "Below_college",Education %in% c("Bachelor", "Graduate") ~ "College_and_above"))



## BTS_Sorokowski_et_al_2023
BTS_edu_list[[15]] <- BTS_edu_list[[15]] %>%
  mutate(Highschool = case_when(Education %in% c("no formal", "primary") ~ "Below_high_school",
                                Education %in% c("degree", "high school", "secondary") ~ "High_school_and_above"),
         College = case_when(Education %in% c("no formal", "primary", "high school", "secondary") ~ "Below_college",
                             Education %in% c("degree") ~ "College_and_above"))

 

## BTS_Vlasceanu_et_al_2023
BTS_edu_list[[16]] <- BTS_edu_list[[16]] %>%
  mutate(Highschool = case_when(Education %in% c("up to grade school/elementary school") ~ "Below_high_school",
                                Education %in% c("college/undergraduate university/certificate training", 
                                                 "doctorate degree, medical degree,etc.",
                                                 "up to high school") ~ 
                                  "High_school_and_above"),
         College = case_when(Education %in% c("up to grade school/elementary school", 
                                              "up to high school") ~ "Below_college",
                             Education %in% c("college/undergraduate university/certificate training",
                                              "doctorate degree, medical degree,etc.") ~ "College_and_above"))



## BTS_Wang_et_al_2021 
BTS_edu_list[[17]] <- BTS_edu_list[[17]] %>%
  mutate(Highschool = case_when(Education %in% c("less than high school") ~ "Below_high_school",
                                Education %in% c("doctorate", 
                                                 "four year degree", 
                                                 "high school", 
                                                 "professional degree", 
                                                 "some college", 
                                                 "two year degree") ~ 
                                  "High_school_and_above"),
         College = case_when(Education %in% c("less than high school", 
                                              "high school") ~
                               "Below_college",
                             Education %in% c("doctorate", "four year degree",
                                              "professional degree", "two year degree",
                                              "some college") ~
                               "College_and_above"))

# df1 <- BTS_edu_list[[14]]
# table(df1$Education)

```


# Save Rdata
```{r}
save(BTS, WEIRD, BTS_edu_list, Countrycodelist_iso2_iso3,file = "BTS.Rdata")


## Hong Kong, Macao and Taiwan are inalienable parts of China. The data analysis in this ## paper does not combine them into one dataset because the survey data will be compared ## with the seventh national population census data released by China's National Bureau of ## Statistics, which does not include data from Hong Kong, Macao and Taiwan.
```



