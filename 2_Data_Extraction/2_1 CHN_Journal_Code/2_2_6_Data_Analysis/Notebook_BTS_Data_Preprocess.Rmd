---
title: "Notebook_BTS_Data_Preprocess"
author: "Lei Yue"
date: "2025-02-06"
output: html_document
---

**Special Note:**BTS\_, This indicates data sourced from large-scale international collaborations.

# install and library packages
```{r}
rm(list = ls())

if (!require("pacman")) install.packages("pacman")

# use package "pacman" as loading R packages tools

pacman::p_load("tidyverse","here","rio")
```


# Load the data of BTS
```{r}
load("D://chin-subj//2_Data_Extraction//2_2_BTS//BTS_data1.Rdata")

load("D://chin-subj//2_Data_Extraction//2_2_BTS//BTS_data2.Rdata")
```


Next, I loaded all BTS data and processed BTS data.
```{r message=FALSE, warning=FALSE, include=FALSE}
BTS_Hall_et_al_2018 <- pro_Hall_et_al_2018
BTS_Lucca_et_al_2024 <- BTS_Kelsey_et_al_2024

rm(pro_Hall_et_al_2018,BTS_Bertolo_et_al_2023,new_name,old_name,proc_vars,
   BTS_Elbæk_et_al_2023_1,BTS_Elbæk_et_al_2023_2,BTS_Kelsey_et_al_2024)


## trans data.frame to list
current_data_frame <- ls()[sapply(ls(), function(x) is.data.frame(get(x)))]
BTS0 <-  mget(current_data_frame)
BTS <- BTS0

rm(current_data_frame)
```


# Process BTS data
Uniform country codes facilitate subsequent data processing and analysis, especially for batch processing and analysis of data. Thus, I created a unified table of country codes.
```{r}
if(!require("countrycode")) install.packages("countrycode")

Countrycodelist <- codelist

Countrycodelist_iso2_iso3 <- Countrycodelist %>% 
  dplyr::select(country.name.en,iso2c,iso3c) %>% 
  dplyr::rename(Countryfullname = 1,ISO2 = 2, ISO3 = 3)

Countrycodelist_iso2_iso3$ISO2[Countrycodelist_iso2_iso3$Countryfullname == "Kosovo"] <- "XK"
Countrycodelist_iso2_iso3$ISO3[Countrycodelist_iso2_iso3$Countryfullname == "Kosovo"] <- "XKX"

## Here, I remove some data sets to reduce data set clutter.
rm(Countrycodelist)
```


The third hypothesis requires countries to be divided into WEIRD and non-WEIRD, so I created a data.frame of WEIRD countries to facilitate subsequent analysis and visualization.
```{r}
WEIRD <- codelist %>% 
  dplyr::select(3,6,iso2c,iso3c,region,region23) %>% 
  dplyr::mutate(WEIRD = ifelse(continent == "Europe" | region == "North America","WEIRD",NA),
                WEIRD = ifelse(continent %in% c("Africa","Asia") | region == "Latin America & Caribbean" | region == "East Asia & Pacific", "Non_WEIRD",WEIRD)) %>% 
  dplyr::mutate(WEIRD = ifelse(country.name.en %in% c("Israel","Australia","New Zealand"), "WEIRD",WEIRD),
                WEIRD = ifelse(is.na(WEIRD),"Non_WEIRD",WEIRD))
```


As the data for the large-scale international collaboration project is constantly updated, recording the names and order of data frames in the list here will facilitate the subsequent improvement of the code.
```{r}
names(BTS)

# [1] "BTS_Anllo_et_al_2023"                                                              
#  [2] "BTS_Arechar_et_al_2023"                                                            
#  [3] "BTS_Atari_et_al_2020"                                                              
#  [4] "BTS_Awad_et_al_2018"                                                               
#  [5] "BTS_Azevedo_et_al_2022"                                                            
#  [6] "BTS_Bago_et_al_2022"                                                               
#  [7] "BTS_Bosson_et_al_2021"                                                             
#  [8] "BTS_Buchanan_et_al_2023"                                                           
#  [9] "BTS_Dorison_et_al_2020"                                                            
# [10] "BTS_Elbæk_et_al_2023"                                                              
# [11] "BTS_Eriksson_et_al_2021"                                                           
# [12] "BTS_Everett_et_al_2021"                                                            
# [13] "BTS_Fernandez_Velasco_et_al_2023"                                                  
# [14] "BTS_Greenberg_et_al_2022"                                                          
# [15] "BTS_Hall_et_al_2018"                                                               
# [16] "BTS_Hoogeveen_et_al_2022"                                                          
# [17] "BTS_Hu_et_al_2019"                                                                 
# [18] "BTS_Jones_et_al_2021"                                                              
# [19] "BTS_Kirkland_et_al_2022"                                                           
# [20] "BTS_Klein_et_al_2018_1"                                                            
# [21] "BTS_Klein_et_al_2018_2"                                                            
# [22] "BTS_Kowal_et_al_2022"                                                              
# [23] "BTS_Lucca_et_al_2024"                                                              
# [24] "BTS_Manokara_et_al_2022"                                                           
# [25] "BTS_Pizzol_et_al_2023"                                                             
# [26] "BTS_Psychological_Science_Accelerator_Self_Determination_Theory_Collaboration_2022"
# [27] "BTS_Ruggeri_et_al_2020"                                                            
# [28] "BTS_Ruggeri_et_al_2022"                                                            
# [29] "BTS_Sorokowski_et_al_2023"                                                         
# [30] "BTS_Tybur_et_al_2016"                                                              
# [31] "BTS_Van_Bavel_et_al_2022"                                                          
# [32] "BTS_Vlasceanu_et_al_2023"                                                          
# [33] "BTS_Wang_et_al_2021"  


## save each data.frame colnames
colname_list <- list()


# Loop through each dataframe in the list
for (name in names(BTS)) {
  
  df <- BTS[[name]]
  col_names <- colnames(df)
  
  temp_df <- data.frame(
    data_source = name,
    column_name = col_names
  )
  colname_list[[name]] <- temp_df
}


# Combine the result list into a single data.frame
BTS_colnames <- do.call(rbind, colname_list)
rm(colname_list,temp_df,col_names,name,df)


table(BTS[[3]]$Country)
```



In this part, I tried to batch country code.

```{r}
# str(BTS)

## Handle some more specific encodings
names(BTS[[20]])[names(BTS[[20]]) == "Country_now"] <- "Country"  ## BTS_Klein 2018 Slate1

names(BTS[[21]])[names(BTS[[21]]) == "Country_now"] <- "Country"  ## BTS_Klein 2018 Slate2

names(BTS[[22]])[names(BTS[[22]]) == "Country_now"] <- "Country"  ## BTS_Kowal 2018

names(BTS[[33]])[names(BTS[[33]]) == "Country_now"] <- "Country"  ## BTS_Wang 2021

names(BTS[[30]])[names(BTS[[30]]) == "Country_ID"]  <-  "Country" ## BTS_Tybur 2016

BTS[[8]]$Country <- trimws(sub(".*-(\\s*)", "", BTS[[8]]$Country))    ## BTS_Buchanan 2023
BTS[[33]]$Country <- trimws(sub(".*-(\\s*)", "", BTS[[33]]$Country))  ## BTS_Wang 2021


## Process the country code use num format




BTS <- BTS[-c(6,14,18)] ## remove data.frame with the country code as num (Bago et al 2022, Greenberg et al 2022, Kirkland et al 2022)


## Check the country code of the BTS data
BTS_countrycode_check <- lapply(BTS, function(df){
  
  df <- df %>% 
    dplyr::group_by(Countrycode) %>% 
    dplyr::summarise(n=n()) %>% 
    dplyr::ungroup()
  
  return(df)
})

BTS_countrycode_check <- do.call(rbind, BTS_countrycode_check)



## process abnormal Countrycode
## BTS_Anllo_et_al_2023
BTS[[1]] <- BTS[[1]] %>% 
  dplyr::mutate(Country = ifelse(Country == "USA", "United States",Country))



## BTS_Arechar_et_al_2023
BTS[[2]] <- BTS[[2]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "GB",Country))



## BST_Atari_et_al_2020
BTS[[3]] <- BTS[[3]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "US", "United States",Country))



## BTS_Awad_et_al_2018
BTS[[4]] <- BTS[[4]] %>% 
  dplyr::mutate(Country = case_when(Country %in% c("TWN","HKG","MAC") ~ "CHN",
                                    TRUE ~ Country))



## BTS_Azevedo_et_al_2022
BTS[[5]] <- BTS[[5]] %>% 
  dplyr::mutate(Country = case_when(Country %in% c("BR1","BR2","BR3") ~ "BR",
                                    Country %in% c("CAe","CAf") ~ "CA",
                                    Country %in% "CO2" ~ "CO",
                                    Country %in% "IN2" ~ "IN",
                                    Country %in% c("IT1","IT2") ~ "IT",
                                    Country %in% "MX2" ~ "MX",
                                    Country %in% "RO2" ~ "RO",
                                    TRUE ~ Country))



# ## BTS_Bertolo_et_al_2023
# BTS[[6]] <- BTS[[6]] %>% 
#   dplyr::mutate(Country = case_when(Country == "Antigua And Barbuda" ~  "Antigua & Barbuda",
#                                     Country == "Artsakh"  ~  "Azerbaijan", #*
#                                     Country %in% c("Côte D'ivoire","Ivory Coast") ~  "Côte d’Ivoire",
#                                     Country == "Democratic People's Republic Of Korea" ~ "North Korea",
#                                     Country == "Democratic Republic Of The Congo" ~ "Congo - Kinshasa",
#                                     Country == "East Timor" ~  "Timor-Leste",
#                                     Country == "Kingdom Of The Netherlands"  ~  "Netherlands",
#                                     Country == "Micronesia"  ~ "Micronesia (Federated States of)",
#                                     Country == "Myanmar"  ~  "Myanmar (Burma)",
#                                     # Country == "Northern Cyprus" #*
#                                     Country == "Palestine"  ~ "Palestinian Territories",
#                                     Country == "Sahrawi Arab Democratic Republic" ~ "Western Sahara", #*
#                                     Country == "Saint Kitts And Nevis" ~ "St. Kitts & Nevis",
#                                     Country == "Saint Lucia" ~ "St. Lucia",
#                                     Country == "Saint Vincent And The Grenadines" ~  "St. Vincent & Grenadines",
#                                     # Country == "Somaliland" ~ "", #*
#                                     # Country == "South Ossetia" ~ "", #*
#                                     Country == "Swaziland" ~ "Eswatini",
#                                     Country == "São Tomé And Príncipe" ~ "São Tomé & Príncipe",
#                                     Country == "The Bahamas" ~ "Bahamas",
#                                     Country == "The Gambia" ~ "Gambia",
#                                     # Country == "Transnistria" ~ "", #*
#                                     Country == "Trinidad And Tobago" ~ "Trinidad & Tobago",
#                                     TRUE ~ Country))




## BTS_Bosson_et_al_2021
BTS[[7]] <- BTS[[7]] %>% 
  dplyr::mutate(Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "CHN", "China",Country),
                Country = ifelse(Country == "UEA", "United Arab Emirates",Country),
                Country = ifelse(Country == "Bosnia and. Herz.","Bosnia & Herzegovina",Country))



## BTS_Buchanan_et_al_2023
BTS[[8]] <- BTS[[8]] %>% 
  dplyr::mutate(Country = case_when(Country %in% c("TWN","HKG","MAC") ~ "CHN",
                                    Country %in% "Ken, Na" ~ "KEN",
                                    TRUE ~ Country))



## BTS_Dorison_et_al_2020
BTS[[9]] <- BTS[[9]] %>% 
  dplyr::mutate(Country = trimws(Country)) %>% 
  dplyr::mutate(Country = ifelse(Country == "TWN" | Country == "HKG"| Country == "MAC","CHN",Country),
                Country = ifelse(Country == "many", NA, Country))



## BTS_Elbæk_et_al_2023



## BTS_Eriksson_et_al_2021
BTS[[11]] <- BTS[[11]] %>% 
  dplyr::mutate(Country = trimws(Country)) %>% 
  dplyr::mutate(Country = case_when(Country == "Ivory Coast" ~  "Côte d’Ivoire",
                                    Country == "Trinidad And Tobago" ~ "Trinidad & Tobago",
                                    Country == "UAE" ~ "United Arab Emirates",
                                    Country == "Czech Republic" ~ "Czechia",
                                    Country == "Bosnia and Herzegovina" ~ "Bosnia & Herzegovina",
                                    
                                    TRUE ~ Country))



## Everett_et_al_2021
BTS[[12]] <- BTS[[12]] %>% 
  dplyr::mutate(Country = ifelse(Country == "Kingdom of Saudi Arabia","Saudi Arabia",Country),
                Country = ifelse(Country == "The Netherlands", "Netherlands",Country))



## BTS_Fernandez_Velasco_et_al_2023
BTS[[13]] <- BTS[[13]] %>%
  dplyr::mutate(Country = case_when(Country %in% c("TW","HK","MO") ~ "CN",
                                    TRUE ~ Country))



## BTS_Greenberg_et_al_2022



## BTS_Hall_et_al_2018
BTS[[15]] <- BTS[[15]] %>%
  dplyr::mutate(Country = case_when(Country %in% c("TWN","HKG","MAC") ~ "CHN",
                                    TRUE ~ Country))



## BTS_Hoogeveen_et_al_2022
BTS[[16]] <- BTS[[16]] %>%
  dplyr::mutate(
    Country = ifelse(Country == "US", "United States", Country),
    Country = ifelse(Country == "CHN", "China", Country),
    Country = ifelse(Country == "UK", "United Kingdom", Country)
  )
                
      

### BTS_Hu_et_al_2019



## BTS_Jones_et_al_2021
BTS[[18]] <- BTS[[18]] %>%
  dplyr::mutate(Country = case_when(Country %in% c("TW","HK","MO") ~ "CN",
                                    TRUE ~ Country))



## BTS_Kirkland_et_al_2022
BTS[[19]] <- BTS[[19]] %>% 
   dplyr::mutate(Country = case_when(Country %in% c("Canada_EN","Canada_FR") ~ "Canada",
                                    Country %in% "CHN" ~ "China",
                                    Country %in% "Hong Kong" ~ "China",
                                    Country %in% c("Northern Ireland","Scotland","Wales","England") ~ "United Kingdom",
                                    Country %in% c("USA_North","USA_South") ~ "United States",
                                    TRUE ~ Country))



## BTS_Klein_et_al_2018 Slate1
BTS[[20]] <- BTS[[20]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "The Netherlands","Netherlands",Country),
                Country = ifelse(Country == "Czech Republic" ,"Czechia",Country))



## BTS_Klein_et_al_2018 Slate2
BTS[[21]] <- BTS[[21]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "The Netherlands","Netherlands",Country),
                Country = ifelse(Country == "Czech Republic" ,"Czechia",Country))



## BTS_Kowal_et_al_2022
BTS[[22]] <- BTS[[22]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "Bosnia and Herzegovina","Bosnia & Herzegovina",Country),
                Country = ifelse(Country == "Czech Republic","Czechia",Country))



# BTS_Lucca_et_al_2024
BTS[[23]] <- BTS[[23]] %>% 
  dplyr::rename(Country = 2) %>% 
  dplyr::mutate(Country = case_when(Country == "babylabamsterdam" ~ "Netherlands",
                                    Country == "babylablmu" ~ "Germany",
                                    Country == "babylabmpib" ~ "Germany",
                                    Country == "babylabosaka" ~ "Japan",
                                    Country == "babylabtrento" ~ "Italy",
                                    Country == "babylabulb" ~ "Belgium",
                                    Country == "babylabuva" ~ "United States",
                                    Country == "babylabvuw" ~ "New Zealand",
                                    Country == "beinghumanwroclaw" ~ "Poland",
                                    Country == "biccbabylab" ~ "Italy",
                                    Country == "bllumanitoba" ~ "Canada",
                                    Country == "cbplabumn" ~ "United States",
                                    Country == "childstudiesucsb"~ "United States",
                                    Country == "cogcienmat_univalle" ~ "Colombia",
                                    Country == "cogdevlabhku"  ~ "China", ## this data is China Hongkong
                                    Country == "corbitlab" ~ "Canada",
                                    Country == "cutelabunak" ~ "Iceland",
                                    Country == "devlabmta" ~ "New Zealand",
                                    Country == "emlasu" ~ "United States",
                                    Country == "epsyrub" ~ "Germany",
                                    Country == "gaugGottingen" ~ "Germany",
                                    Country == "ikidstutsc" ~ "Canada",
                                    Country == "infantcog_ubc" ~ "Canada",
                                    Country == "irlconcordia" ~ "Canada",
                                    Country == "kidsdevuniofnewcastle" ~ "Australia",
                                    Country == "kikoceu" ~ "Hungary",
                                    Country == "langdevhaifa" ~ "Israel",
                                    Country == "lmumunich" ~ "Germany",
                                    Country == "mecdmpihcbs" ~ "Germany",
                                    Country == "pkusu" ~ "China",
                                    Country == "socallabucsd" ~ "United States",
                                    Country == "uiwcarl" ~ "United States",
                                    Country == "weltentdeckerzurich" ~ "Switzerland",
                                    Country == "wsumarcs" ~ "Australia",
                                    Country == "yonseichild" ~ "South Korea",
                                    TRUE ~ Country))




## BTS_Mankara_et_al_2022
BTS[[24]] <- BTS[[24]] %>% 
  dplyr::mutate(Country = ifelse(Country == "CHN","China",Country))



## BTS_Pizzol_et_al_2023
BTS[[25]] <- BTS[[25]] %>% 
  dplyr::mutate(Country = case_when(Country == "Korea, Rep." ~  "South Korea",
                                    Country == "Russian Federation" ~ "Russia",
                                    Country == "Slovak Republic" ~ "Slovakia",
                                    Country == "Taiwan, China" ~ "China",
                                    Country == "Venezuela, RB" ~ "Venezuela",
                                    TRUE ~ Country))



## BTS_Psychological_Science_Accelerator_Self_Determination_Theory_Collaboration_2022
BTS[[26]] <- BTS[[26]] %>% 
  dplyr::mutate(Country = ifelse(Country == "IRAN", "IRN", Country),
                Country = ifelse(Country == "SLO", NA, Country),
                Country = ifelse(Country == "TWN" | Country =="HKG" | Country == "MAC","CHN",Country))



## BTS_Ruggeri_et_al_2020
BTS[[27]] <- BTS[[27]] %>% 
  dplyr::mutate(Country = ifelse(Country == "UK", "United Kingdom",Country),
                Country = ifelse(Country == "USA", "United States",Country),
                Country = ifelse(Country == "Mainland China" | Country == "Hong Kong", "China",Country))



## BTS_Ruggeri_et_al_2022
BTS[[28]] <- BTS[[28]] %>% 
  dplyr::mutate(Country = ifelse(Country == "BRG", "BGR",Country),
                Country = ifelse(Country == "SRP", "SGP",Country))



## BTS_Sorokowski_et_al_2023
BTS[[29]] <- BTS[[29]] %>% 
  dplyr::mutate(Country = ifelse(Country == "The Netherlands", "Netherlands",Country),
                Country = ifelse(Country == "CHN","China",Country))



# BTS_Tybur_et_al_2016 
BTS[[30]] <- BTS[[30]] %>% 
  dplyr::mutate(Country = as.character(Country),
                Country = case_when(Country == "1" ~ "IL",
                                    Country == "2" ~ "SG",
                                    Country == "3" ~ "BE",
                                    Country == "4" ~ "RS",
                                    Country == "5" ~ "ES",
                                    Country == "6" ~ "AU",
                                    Country == "7" ~ "SK",
                                    Country == "8" ~ "FR",
                                    Country == "9" ~ "NZ",
                                    Country == "10" ~ "DK",
                                    Country == "11" ~ "IN",
                                    Country == "12" ~ "JP",
                                    Country == "13" ~ "DE",
                                    Country == "14" ~ "HR",
                                    Country == "15" ~ "PL",
                                    Country == "16" ~ "TR",
                                    Country == "17" ~ "US",
                                    Country == "18" ~ "CA",
                                    Country == "19" ~ "GR",
                                    Country == "20" ~ "IE",
                                    Country == "21" ~ "NL",
                                    Country == "22" ~ "BA",
                                    Country == "23" ~ "UK",
                                    Country == "24" ~ "CL",
                                    Country == "25" ~ "KR",
                                    Country == "26" ~ "SE",
                                    Country == "27" ~ "FI",
                                    Country == "28" ~ "BR",
                                    Country == "29" ~ "AR",
                                    Country == "30" ~ "CN",
                                    TRUE ~ Country))



## BTS_Van_Bavel_et_al_2022
BTS[[31]] <- BTS[[31]] %>% 
  dplyr::mutate(Country = as.character(unclass(Country)),
                Country = case_when(Country == "TW" ~ "CN",
                                    TRUE ~ Country))



## BTS_Vlasceanu_et_al_2023
BTS[[32]] <- BTS[[32]] %>% 
  dplyr::mutate(Country = ifelse(Country == "Uk", "United Kingdom",Country),
                Country = ifelse(Country == "Usa", "United States",Country),
                Country = case_when(Country == "Newzealand" ~ "New Zealand",
                                    Country == "Northmacedonia" ~ "North Macedonia",
                                    Country == "Saudiarabia" ~ "Saudi Arabia",
                                    Country == "Southafrica" ~ "South Africa",
                                    Country == "Southkorea" ~ "South Korea",
                                    Country == "Srilanka" ~ "Sri Lanka",
                                    Country == "Unitedarabemirates" ~ "United Arab Emirates",
                                    Country == "Taiwan" ~ "China",
                                    TRUE ~ Country))

                                    
                                    
## BTS_Wang_et_al_2021
BTS[[33]] <- BTS[[33]] %>% 
  dplyr::mutate(Country = ifelse(Country == "China", "CHN",Country))

  

## Combine the BTS_data and Countrycodelist_iso2_iso3
Countrycode_merge <- function(df, Countrycode) {  
  
  Countrycode_lengths <- nchar(as.character(df$Country))  
  Countrycode_lengths <- Countrycode_lengths[!is.na(Countrycode_lengths)]  
 
  if (all(Countrycode_lengths == 2)) {  
    
    merge_key <- "ISO2"  
  } else if (any(Countrycode_lengths > 3)) {  
   
    merge_key <- "Countryfullname"  
  } else {  
   
    merge_key <- "ISO3"  
  }  
    
  merged_df <- merge(df, Countrycode, by.x = "Country", by.y = merge_key, all.x = TRUE)  
    
  return(merged_df)  
}  
  
BTS <- lapply(BTS, Countrycode_merge, Countrycode = Countrycodelist_iso2_iso3)  

## Change the column name so that each BTS data has "ISO3"
BTS <- lapply(BTS,function(df){
  
  if(!"ISO3" %in% names(df)){
    
    df <- df %>% 
      dplyr::mutate(ISO3 = Country)
  }
  
  return(df)
  
})

## Change the column name so that each BTS data has "ISO2"
BTS <- lapply(BTS,function(df){
  
  if(!"ISO2" %in% names(df)){
    
    df <- df %>% 
      dplyr::mutate(ISO2 = Country)
  }
  
  return(df)
  
})


## Change the column name so that each BTS data has "countryfullname"
BTS <- lapply(BTS,function(df){
  
  if(!"Countryfullname" %in% names(df)){
    
    df <- df %>% 
      dplyr::mutate(Countryfullname = Country)
  }
  
  return(df)
  
})


## Because the country code of the countrycode package is the full name, but some of the actual data set is recorded by abbreviation (for example: United States is USA), so this part is not converted properly, and is now found and processed separately.
## BTS_Bertolo_et_al_2023
BTS[[6]] <- BTS[[6]] %>% 
  dplyr::mutate(Article_Id = "Bertolo_et_al_2023")


## BTS_Lucca_et_al_2024
BTS[[19]] <- BTS[[19]] %>% 
  dplyr::mutate(Article_Id = "Lucca_et_al_2024")


BTS_na <- lapply(BTS, function(df){
  
  df <- df %>% 
    dplyr::filter(is.na(ISO3)) %>% 
    dplyr::select(Article_Id, Country, ISO3)
  
  return(df)
})

BTS_na <- do.call(rbind,BTS_na)

BTS_na_table <- BTS_na %>% 
  dplyr::group_by(Article_Id,Country) %>% 
  dplyr::summarise(n=n())
```


process gender data of BTS
```{r}
## Batch processing of gender for different data sources
BTS <- lapply(BTS,function(df){
  
  df <- df %>% 
    dplyr::mutate(Gender = case_when(Gender %in% c("f","F") ~ "Female",
                              Gender %in% c("m","M") ~ "Male",
                              TRUE ~ Gender),
           Gender = str_to_title(Gender))
  
  return(df)
  
})


## Check the gender of the BTS data
BTS_gender_check <- lapply(BTS, function(df){
  
  df <- df %>% 
    dplyr::group_by(Gender) %>% 
    dplyr::summarise(n=n()) %>% 
    dplyr::ungroup()
  
  return(df)
})

BTS_gender_check <- do.call(rbind, BTS_gender_check)

# BTS_gender_check %>% 
#   dplyr::filter(Gender %in% c("Female","Male")) %>% 
#   dplyr::summarise(n=sum(n))

# write.csv(BTS_gender_check,"BTS_gender_check.csv")
```


process age data of BTS
```{r}
## Lucca et al. 2024'Age use age days record subjects' age, therefore I will transform
## Lucca et al. 2024
BTS[[19]] <- BTS[[19]] %>% 
  dplyr::mutate(Age = round((Age_days/365),2))

```


process attainment education of BTS
```{r}
## BTS_Eriksson_et_al_2021
# bts1 <- BTS[[6]]
# table(bts1$Education)
# 
# bts1 <- BTS[[13]] %>% 
#   dplyr::mutate(Education = case_when(Education == ""))
```

Process Article_ID
```{r}
BTS[[1]] <- BTS[[1]] %>% 
  dplyr::mutate(Article_Id = "Anllo_et_al_2023")
```



```{r include=FALSE}
## Here, I remove some data sets to reduce data set clutter.
rm(BTS_na_table,BTS_na,Countrycode_merge,BTS_countrycode_check)
gc()
```


# Save Rdata
```{r}
save(BTS, WEIRD, Countrycodelist_iso2_iso3,file = "BTS.Rdata")
```

